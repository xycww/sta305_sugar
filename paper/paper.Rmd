---
title: "Analysis of How Do Temperature, Sugar Type, and Stirring Affect Sugar Dissolution Time"
author: "Sakura Hu"
output:
  pdf_document: default
  html_document: default
number-sections: true
thanks: "Code and data are available at: [https://github.com/xycww/sta305_sugar](https://github.com/xycww/sta305_sugar)."
---
# Description of the design
This experiment investigates how three factors—water temperature, sugar type, and stirring—affect the dissolution time of granulated sugar. A replicated 2^3 full factorial design was used, involving three factors at two levels each, resulting in eight treatment combinations. Each combination was replicated three times, yielding a total of 24 trials. This design was chosen because it offers a comprehensive yet manageable framework to examine both main effects and interaction effects, while enabling replication to estimate experimental variability.

The selected factors represent distinct mechanisms influencing solubility. 

- **Water Temperature**: cold tap water vs. hot water at 70°C. This variable is chosen since it affects molecular motion and reaction rates (thermal effects). 

- **Sugar Type**: White granulated sugar vs. brown granulated sugar. This variable is chosen since it influences dissolution via chemical composition and crystal structure.

- **Stirring**: No stirring vs. stirring at a consistent speed (approximately two full rotations per second using a spoon). This variable is chosen since it could accelerate solute dispersion.

To conduct the experiment, 450 mL of water was measured into a clear container for each trial, with temperature conditions prepared using either cold tap water or freshly boiled water cooled briefly. One teaspoon (5 mL) of the designated sugar type was added, and a stopwatch was started simultaneously. For stirring conditions, the solution was stirred by hand in a consistent circular motion; otherwise, no external movement was applied. Timing stopped once all visible granules were dissolved, and the result was recorded in seconds. Trials were performed in randomized order to mitigate systematic bias.

This setup was selected due to its feasibility under individual constraints: it requires no specialized equipment or human participants, yet still allows for full experimental control. Each factor is clearly defined, discretely manipulable, and easily repeated, and the response variable—**time to full dissolution**—is straightforward to quantify.

Beyond practicality, the experiment serves as a model for broader physical processes, particularly in contexts such as food preparation, beverage formulation, and industrial solubility studies. The factorial design allows not only for the assessment of individual effects (e.g., temperature alone) but also complex interactions—such as whether the effect of stirring depends on temperature, or whether brown sugar dissolves disproportionately slower in cold water without agitation. Identifying such interactions is often more informative than studying single factors in isolation, and the results of this design may provide insight into how simple environmental variables combine to influence a commonly encountered chemical process.

# Analysis of the data
```{r, include=FALSE}
#load all libraries
library(tidyverse)
library(FrF2)
library(dplyr)
library(ggplot2)
```

```{r, include=FALSE}
#load the data
data <- read.csv("../data/sugar.csv")
head(data)
```


```{r, include=FALSE}
data$x1 <- ifelse(data$Temp == "hot", 1, -1)
data$x2 <- ifelse(data$Sugar == "white", 1, -1)
data$x3 <- ifelse(data$Stirring == "yes", 1, -1)

# Interaction terms
data$x4 <- data$x1 * data$x2
data$x5 <- data$x1 * data$x3
data$x6 <- data$x2 * data$x3
data$x7 <- data$x1 * data$x2 * data$x3

model_coded <- lm(Time_to_Dissolve ~ x1 + x2 + x3 + x4 + x5 + x6 + x7, data = data)
summary(model_coded)

```



```{r}
#| warning: false
#| message: false
#| echo: false

# Extract beta estimates
estimates <- summary(model_coded)$coefficients
beta_hat <- coef(model_coded)[c("x1", "x2", "x3", "x4", "x5", "x6", "x7")]
effect_estimates <- 2 * beta_hat

# Estimated variance of effects
m <- 3
k <- 3
sigma2 <- summary(model_coded)$sigma^2
var_effect <- (4 * sigma2) / (m * 2^k)
se_effect <- sqrt(var_effect)

# Degrees of freedom for error
df <- summary(model_coded)$df[2]

# t-critical value for 95% CI
t_crit <- qt(0.975, df)

# Compute confidence intervals
lower <- effect_estimates - t_crit * se_effect
upper <- effect_estimates + t_crit * se_effect

# Final table
effects_table <- data.frame(
  Effect = c("Temperature (x1)", 
             "Sugar Type (x2)", 
             "Stirring (x3)",
             "Temp × Sugar (x4)", 
             "Temp × Stirring (x5)", 
             "Sugar × Stirring (x6)", 
             "Temp × Sugar × Stirring (x7)"),
  Estimate = round(effect_estimates, 2),
  Var = round(var_effect, 2),
  CI_Lower = round(lower, 2),
  CI_Upper = round(upper, 2),
  p_value = signif(estimates[c("x1", "x2", "x3", "x4", "x5", "x6", "x7"), "Pr(>|t|)"], 3)
)


# Display
knitr::kable(effects_table, caption = "Main Effects and Interactions with Estimated Variance and 95% Confidence Intervals")

```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-interact
#| fig-cap: 'Interaction plots for the three two-way interactions in the \(2^3\) factorial experiment. Each panel shows how the mean dissolution time (in seconds) varies with two interacting factors. In the first plot (Temp × Sugar), the effect of temperature on dissolution time appears similar across sugar types. In the second plot (Temp × Stirring), the effect of stirring is much stronger under cold conditions, indicating a meaningful interaction. In the third plot (Sugar × Stirring), the lines are nearly parallel, suggesting minimal interaction between sugar type and stirring.'
#| fig.width: 12
#| fig.height: 3

data_long <- data %>%
  mutate(
    Temp = factor(Temp, labels = c("Cold", "Hot")),
    Stirring = factor(Stirring, labels = c("No", "Yes")),
    Sugar = factor(Sugar, labels = c("White", "Brown"))
  )

# Set layout: 1 row, 3 plots side by side
par(mfrow = c(1, 3), mar = c(4, 4, 2, 1))  # Adjust margins for spacing

# First: Temp × Sugar
interaction.plot(
  x.factor = data_long$Temp,
  trace.factor = data_long$Sugar,
  response = data_long$Time_to_Dissolve,
  xlab = "Temperature",
  ylab = "Mean Dissolution Time (s)",
  trace.label = "Sugar Type",
  main = "Temp × Sugar",
  col = c("blue", "orange"),
  lwd = 2
)

# Second: Temp × Stirring
interaction.plot(
  x.factor = data_long$Temp,
  trace.factor = data_long$Stirring,
  response = data_long$Time_to_Dissolve,
  xlab = "Temperature",
  ylab = "",
  trace.label = "Stirring",
  main = "Temp × Stirring",
  col = c("blue", "orange"),
  lwd = 2
)

# Third: Sugar × Stirring
interaction.plot(
  x.factor = data_long$Sugar,
  trace.factor = data_long$Stirring,
  response = data_long$Time_to_Dissolve,
  xlab = "Sugar Type",
  ylab = "",
  trace.label = "Stirring",
  main = "Sugar × Stirring",
  col = c("blue", "orange"),
  lwd = 2
)

```

# Conclusions